<div
  class="mx-auto flex min-h-screen max-w-md flex-col bg-white p-4 md:max-w-lg lg:max-w-xl"
>
  <!-- Header -->
  <div class="mb-4 text-center">
    <h1 class="mb-2 text-2xl font-bold text-gray-800 sm:text-3xl">Wordle</h1>
    <p class="text-xs text-gray-600 sm:text-sm">Devinez le mot en 6 essais</p>
    <button
      (click)="onShowInstructions()"
      class="mt-2 text-xs text-blue-500 underline hover:text-blue-700"
    >
      Comment jouer ?
    </button>
  </div>

  <!-- Instructions Modal -->
  <app-instructions-modal
    [isVisible]="showInstructions()"
    (close)="onCloseInstructions()"
  >
  </app-instructions-modal>

  <!-- Error Popup Component -->
  <app-pop-up
    [message]="invalidWordMessage()"
    [isVisible]="invalidWord()"
    [type]="messageType()"
  >
  </app-pop-up>

  <!-- Game Board -->
  <div class="mb-4 grid flex-1 grid-rows-6 gap-1 sm:gap-2 md:gap-3">
    @for (guess of guesses(); track $index; let rowIndex = $index) {
      <div
        class="grid grid-cols-5 justify-center gap-1 sm:gap-2 md:gap-3"
        [ngClass]="{
          shake: invalidWord() && rowIndex === getCurrentRowIndex(),
        }"
      >
        @for (
          letter of [0, 1, 2, 3, 4];
          track $index;
          let letterIndex = $index
        ) {
          <div
            class="flex aspect-square w-full items-center justify-center rounded-sm border-3 text-2xl font-bold uppercase transition-colors duration-300 sm:text-3xl md:text-4xl lg:text-5xl"
            [ngClass]="{
              'border-gray-300 bg-white text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                !isCurrentPosition(rowIndex, letterIndex),
              'border-blue-500 bg-blue-50 text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                isCurrentPosition(rowIndex, letterIndex),
              'border-gray-500 bg-white text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                getLetterForPosition(rowIndex, letterIndex),
              'border-green-500 bg-green-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'correct',
              'border-yellow-500 bg-yellow-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'present',
              'border-gray-500 bg-gray-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'absent',
            }"
          >
            {{ getLetterForPosition(rowIndex, letterIndex) }}
          </div>
        }
      </div>
    }
  </div>

  <!-- Game Status -->
  @if (gameStatus(); as status) {
    @if (status !== "playing") {
      <div class="mb-4 text-center">
        <div
          class="rounded-lg p-3 sm:p-4 md:p-5"
          [ngClass]="{
            'bg-green-100 text-green-800': status === 'won',
            'bg-red-100 text-red-800': status === 'lost',
          }"
        >
          @if (status === "won") {
            <p class="text-base font-semibold sm:text-lg md:text-xl">
              ðŸŽ‰ FÃ©licitations ! Vous avez trouvÃ© le mot !
            </p>
          }
          @if (status === "lost") {
            <p class="text-base font-semibold sm:text-lg md:text-xl">
              ðŸ˜ž Dommage ! Le mot Ã©tait :
              {{ wordleService.getCurrentWord().toUpperCase() }}
            </p>
          }
          <button
            (click)="onNewGame()"
            class="mt-3 rounded-lg bg-blue-500 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-600 sm:text-base md:text-lg"
          >
            Nouvelle partie
          </button>
        </div>
      </div>
    }

    <!-- Virtual Keyboard -->
    <div class="space-y-1 sm:space-y-2 md:space-y-3">
      @for (row of keyboardRows; track $index; let rowIndex = $index) {
        <div
          class="flex justify-center gap-1 sm:gap-1.5 md:gap-2"
          [ngClass]="{
            'px-2 sm:px-4 md:px-6': rowIndex === 1,
            'px-1 sm:px-2 md:px-4': rowIndex === 2,
          }"
        >
          @for (key of row; track $index; let keyIndex = $index) {
            <button
              (click)="
                key === 'ENTER'
                  ? onEnter()
                  : key === 'BACKSPACE'
                    ? onBackspace()
                    : onLetterClick(key)
              "
              class="h-10 min-w-8 cursor-pointer rounded text-xs font-semibold transition-colors duration-200 sm:h-12 sm:min-w-10 sm:text-sm md:h-14 md:min-w-12 md:text-base lg:h-16 lg:min-w-14 lg:text-lg"
              [ngClass]="{
                'bg-gray-400 text-white hover:bg-gray-500':
                  key === 'ENTER' || key === 'BACKSPACE',
                'bg-gray-200 text-gray-800 hover:bg-gray-300':
                  getKeyStatus(key) === 'unused' &&
                  key !== 'ENTER' &&
                  key !== 'BACKSPACE',
                'bg-green-500 text-white': getKeyStatus(key) === 'correct',
                'bg-yellow-500 text-white': getKeyStatus(key) === 'present',
                'bg-gray-600 text-gray-300': getKeyStatus(key) === 'absent',
              }"
              [disabled]="status !== 'playing'"
            >
              @if (key === "BACKSPACE") {
                <img
                  src="/icons/backspace.svg"
                  alt="{{ key }}"
                  class="mx-auto h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6"
                />
              } @else if (key === "ENTER") {
                <img
                  src="/icons/enter.svg"
                  alt="{{ key }}"
                  class="mx-auto h-3 w-3 sm:h-4 sm:w-4 md:h-5 md:w-5"
                />
              } @else {
                <span>{{ key }}</span>
              }
            </button>
          }
        </div>
      }
    </div>
  }
</div>
