<div class="mx-auto min-h-screen max-w-md bg-white p-4">
  <!-- Header -->
  <div class="mb-8 text-center">
    <h1 class="mb-2 text-3xl font-bold text-gray-800">Wordle</h1>
    <p class="text-sm text-gray-600">Devinez le mot en 6 essais</p>
  </div>

  <!-- Error Popup Component -->
  <app-pop-up
    [message]="invalidWordMessage()"
    [isVisible]="invalidWord()"
    [type]="messageType()"
  >
  </app-pop-up>

  <!-- Game Board -->
  <div class="mb-8 grid grid-rows-6 gap-2">
    @for (guess of guesses(); track $index; let rowIndex = $index) {
      <div
        class="grid grid-cols-5 justify-center gap-2"
        [ngClass]="{
          shake: invalidWord() && rowIndex === getCurrentRowIndex(),
        }"
      >
        @for (
          letter of [0, 1, 2, 3, 4];
          track $index;
          let letterIndex = $index
        ) {
          <div
            class="flex aspect-square w-full items-center justify-center rounded-sm border-3 text-4xl font-bold uppercase transition-colors duration-300"
            [ngClass]="{
              'border-gray-300 bg-white text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                !isCurrentPosition(rowIndex, letterIndex),
              'border-blue-500 bg-blue-50 text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                isCurrentPosition(rowIndex, letterIndex),
              'border-gray-500 bg-white text-gray-700':
                getStatusForPosition(rowIndex, letterIndex) === 'empty' &&
                getLetterForPosition(rowIndex, letterIndex),
              'border-green-500 bg-green-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'correct',
              'border-yellow-500 bg-yellow-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'present',
              'border-gray-500 bg-gray-500 text-white':
                getStatusForPosition(rowIndex, letterIndex) === 'absent',
            }"
          >
            {{ getLetterForPosition(rowIndex, letterIndex) }}
          </div>
        }
      </div>
    }
  </div>

  <!-- Game Status -->
  @if (gameStatus(); as status) {
    @if (status !== "playing") {
      <div class="mb-6 text-center">
        <div
          class="rounded-lg p-4"
          [ngClass]="{
            'bg-green-100 text-green-800': status === 'won',
            'bg-red-100 text-red-800': status === 'lost',
          }"
        >
          @if (status === "won") {
            <p class="text-lg font-semibold">
              ðŸŽ‰ FÃ©licitations ! Vous avez trouvÃ© le mot !
            </p>
          }
          @if (status === "lost") {
            <p class="text-lg font-semibold">
              ðŸ˜ž Dommage ! Le mot Ã©tait :
              {{ wordleService.getCurrentWord().toUpperCase() }}
            </p>
          }
          <button
            (click)="onNewGame()"
            class="mt-3 rounded-lg bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600"
          >
            Nouvelle partie
          </button>
        </div>
      </div>
    }

    <!-- Virtual Keyboard -->
    <div class="space-y-2">
      @for (row of keyboardRows; track $index; let rowIndex = $index) {
        <div
          class="flex justify-center gap-1"
          [ngClass]="{ 'px-4': rowIndex === 1, 'px-2': rowIndex === 2 }"
        >
          @for (key of row; track $index; let keyIndex = $index) {
            <button
              (click)="
                key === 'ENTER'
                  ? onEnter()
                  : key === 'BACKSPACE'
                    ? onBackspace()
                    : onLetterClick(key)
              "
              class="h-12 min-w-10 cursor-pointer rounded text-sm font-semibold transition-colors duration-200"
              [ngClass]="{
                'bg-gray-400 text-white hover:bg-gray-500':
                  key === 'ENTER' || key === 'BACKSPACE',
                'bg-gray-200 text-gray-800 hover:bg-gray-300':
                  getKeyStatus(key) === 'unused' &&
                  key !== 'ENTER' &&
                  key !== 'BACKSPACE',
                'bg-green-500 text-white': getKeyStatus(key) === 'correct',
                'bg-yellow-500 text-white': getKeyStatus(key) === 'present',
                'bg-gray-600 text-gray-300': getKeyStatus(key) === 'absent',
              }"
              [disabled]="status !== 'playing'"
            >
              @if (key === "BACKSPACE") {
                <img
                  src="/icons/backspace.svg"
                  alt="{{ key }}"
                  class="mx-auto h-5 w-5"
                />
              } @else if (key === "ENTER") {
                <img
                  src="/icons/enter.svg"
                  alt="{{ key }}"
                  class="mx-auto h-5 w-4"
                />
              } @else {
                <span>{{ key }}</span>
              }
            </button>
          }
        </div>
      }
    </div>
  }

  <!-- Instructions -->
  <div class="mt-8 space-y-1 text-center text-xs text-gray-500">
    <p>ðŸŸ© Lettre correcte Ã  la bonne position</p>
    <p>ðŸŸ¨ Lettre prÃ©sente mais mal placÃ©e</p>
    <p>â¬œ Lettre absente du mot</p>
  </div>
</div>
<p>â¬œ Lettre absente du mot</p>
